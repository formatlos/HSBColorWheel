/**
 *  @author Martin Raedlinger (mr@formatlos.de)
 */HSBColorWheel=function(e,t){function n(e,n,o,u,a){function k(){l.css({position:"absolute"});var e=Math.floor((x-S-3*T)/3),t=x;if(!h){h=new r(l,"h",t,t-e);h.onChange(function(){B(h)})}t-=e;C=="inner"&&h.addShadow(t,1996488704,0,-10);t-=T;C=="outer"&&h.addShadow(t,1996488704,0,10);if(!d){d=new r(l,"s",t+1,t-e);d.onChange(function(){B(d)})}t-=e;C=="inner"&&h.addShadow(t,1996488704,0,-10);t-=T;C=="outer"&&h.addShadow(t,1996488704,0,10);if(!p){p=new r(l,"b",t+1,t-e);p.onChange(function(){B(p)})}t-=e;C=="inner"&&h.addShadow(t,1996488704,0,-10);t-=T;C=="outer"&&h.addShadow(t,1996488704,0,10);v||(v=new i(l,t+1));c.on("mousedown"+f,q);c.on("mousemove"+f,R);c.on("mouseup"+f,U);l.on("mouseenter"+f,z);l.on("mouseleave"+f,W);j()}function L(){m=null;if(v){v.finalize();v=null}if(h){h.finalize();h=null}if(d){d.finalize();d=null}if(p){p.finalize();p=null}if(l){l.off(f);l.remove();l=null}if(c){c.off(f);c=null}}function A(e){N=e}function O(){var e=s.HSBtoRGB(b,w,E);return s.RGBToHex(e[0],e[1],e[2])}function M(){var e=s.HSBtoRGB(b,w,E);return{r:e[0],g:e[1],b:e[2]}}function _(e){var t=s.RGBtoHSB(e.r,e.g,e.b);b=t[0];w=t[1];E=t[2];j()}function D(){return{h:b,s:w,b:E}}function P(e){b=e.h;w=e.s;E=e.b;j()}function H(e,t){l.css({top:t,left:e})}function B(e){I();F(e==h,e!=p);var t={h:b,s:w,b:E},n={h:b,s:w,b:E};N&&N(D(),M())}function j(){h.setValue(b);d.setValue(w);p.setValue(E);F(!0,!0)}function F(e,t){var n,r;if(e){n=s.HSBtoRGB(b,1,1);r=s.RGBToHex(n[0],n[1],n[2]);d.setColor(r)}if(t){n=s.HSBtoRGB(b,w,1);r=s.RGBToHex(n[0],n[1],n[2]);p.setColor(r)}v.setColor(O())}function I(){b=h.getValue();w=d.getValue();E=p.getValue()}function q(e){if(!m)return;g=!0;m.mouseDown(e)}function R(e){if(!y)return;if(!g){var t=X(e.pageX,e.pageY);if(t!==m){m&&m.mouseOut();m=t;m&&m.mouseOver(e)}}m&&m.mouseMove(e)}function U(e){g=!1;if(!m)return;m.mouseUp(e);R(e)}function z(e){y=!0}function W(e){U(e);R(e);y=!1}function X(e,t){var n=l.offset(),r=e-n.left,i=t-n.top,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));if(h.isOver(s))return h;if(d.isOver(s))return d;if(p.isOver(s))return p}var f=".hsbcolorwheel",l=t('<div class="hsbcolorwheel"></div>').appendTo(e),c=t("body"),h=null,p=null,d=null,v=null,m=null,g=!1,y=!1,b=360,w=1,E=1,S=o||50,x=n||200,T=u||0,N=undefined,C=a;k();this.finalize=L;this.onChange=A;this.setRGB=_;this.getRGB=M;this.setHSB=P;this.getHSB=D;this.setPosition=H}function r(e,n,r,i){function C(){return N}function k(e){N=e;R()}function O(){return c=="h"?A*360:A}function M(e){c=="h"&&(e/=360);A=o.clamp(e,0,1);var t=360;if(c=="s"||c=="b")t=180;W((1-A)*t)}function _(){f=t("<div></div>").prependTo(e);m=t("<div></div>").appendTo(f);if(!L&&(c=="s"||c=="b")){b=t('<canvas width="'+x+'" height="'+x+'"></canvas>').appendTo(m);b.css({position:"absolute","margin-top":-S+"px","margin-left":-S+"px","-webkit-user-select":"none"});w=b.get(0).getContext("2d")}g=t('<canvas width="'+x+'" height="'+x+'"></canvas>').appendTo(m);g.css({position:"absolute","margin-top":-S+"px","margin-left":-S+"px","-webkit-user-select":"none"});y=g.get(0).getContext("2d");l=t("<div></div>").appendTo(f);l.css({position:"absolute","margin-top":-S+"px",width:"0px",height:"0px",opacity:"0.0","border-style":"solid","border-width":"15px 3px 0 3px","border-color":"#000000 transparent transparent transparent"});U();R()}function D(){v=null;g=null;l=null;y=null;m=null;b=null;w=null;if(f){f.remove();f=null}}function P(e){v=e}function H(e){return e>=E&&e<=S}function B(e){var t=f.offset(),n=e.pageX-t.left,r=e.pageY-t.top;p=h-Math.atan2(r,n)*(180/Math.PI);d=!0}function j(e){if(!d)return;var t=f.offset(),n=e.pageX-t.left,r=e.pageY-t.top;W(Math.atan2(r,n)*(180/Math.PI)+p);X(!0)}function F(e){if(!d)return;d=!1}function I(){l.stop().animate({opacity:.6},300)}function q(){l.stop().animate({opacity:0},300)}function R(){if(L){y.clearRect(0,0,x,x);if(c=="h")u.drawCircleSegmentSpectrum(y,180,540,S,E,T);else if(c=="s"){u.drawCircleSegmentGradient(y,16777215,N,0,180,S,E,T);u.drawCircleSegmentGradient(y,N,16777215,180,360,S,E,T)}else if(c=="b"){u.drawCircleSegmentGradient(y,0,N,0,180,S,E,T);u.drawCircleSegmentGradient(y,N,0,180,360,S,E,T)}}else if(c=="s"||c=="b"){w.clearRect(0,0,x,x);u.drawCircle(w,N,S,E,T)}}function U(){if(L)return;y.clearRect(0,0,x,x);c=="h"?u.drawCircleSegmentSpectrum(y,180,540,S,E,T):c=="s"?u.drawCircleGradient(y,16777215,S,E,T):c=="b"&&u.drawCircleGradient(y,0,S,E,T)}function z(e,t,n,r){var i;i=y.createRadialGradient(T.x,T.y,e,T.x,T.y,e+r);i.addColorStop(0,s.uintToRGBAString(t));i.addColorStop(1,s.uintToRGBAString(n));y.fillStyle=i;y.beginPath();y.arc(T.x,T.y,e,0,2*Math.PI,!1);y.arc(T.x,T.y,e+r,0,2*Math.PI,!0);y.fill()}function W(e){h=e;var t="rotate("+h+"deg)";m.css({"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}function X(e){var t=o.normalizeAngle(h),n;if(c=="s"||c=="b"){t>180&&(t=360-t);n=1/180}else n=1/360;var r=1-o.clamp(t*n,0,1);if(r!=A){A=r;e&&v&&v()}}var f=null,l=null,c=n||"h",h=0,p=0,d=!1,v=undefined,m=null,g=null,y=null,b=null,w=null,E=i,S=r,x=S*2,T=new a(S,S),N=0,L=!1,A=0;_();this.getColor=C;this.setColor=k;this.setValue=M;this.getValue=O;this.mouseDown=B;this.mouseMove=j;this.mouseUp=F;this.mouseOver=I;this.mouseOut=q;this.isOver=H;this.onChange=P;this.finalize=D;this.addShadow=z}function i(e,n){function f(e){a=e;h()}function l(){r=t('<canvas width="'+u+'" height="'+u+'"></canvas>').prependTo(e);r.css({position:"absolute","margin-top":-o+"px","margin-left":-o+"px"});i=r.get(0).getContext("2d")}function c(){i=null;if(r){r.remove();r=null}}function h(){i.clearRect(0,0,u,u);i.fillStyle=s.uintToWebString(a);i.beginPath();i.arc(o,o,o,0,Math.PI*2,!1);i.closePath();i.fill()}var r=null,i=null,o=n,u=o*2,a=0;l();this.setColor=f;this.finalize=c}function a(e,t){function n(e){return new a(this.x+e.x,this.y+e.y)}function r(){return Math.sqrt(this.x*this.x+this.y*this.y)}function i(e){return new a(this.x-e.x,this.y-e.y)}this.x=e||0;this.y=t||0;this.length=r;this.subtract=i;this.add=n}var s=function(){return{interpolateColor:function(e,t,n){var r=1-n,i=e>>24&255,s=e>>16&255,o=e>>8&255,u=e&255,a=t>>24&255,f=t>>16&255,l=t>>8&255,c=t&255,h=i*r+a*n,p=s*r+f*n,d=o*r+l*n,v=u*r+c*n,m=h<<24|p<<16|d<<8|v;return m},uintToWebString:function(e,t){t=t||6;var n=e.toString(16).toUpperCase();while(n.length<t)n="0"+n;return"#"+n.toUpperCase()},uintToRGBString:function(e){var t=e>>16&255,n=e>>8&255,r=e&255;return"rgb("+t+","+n+","+r+")"},uintToRGBAString:function(e){var t=(e>>24&255)/255,n=e>>16&255,r=e>>8&255,i=e&255;return"rgba("+n+","+r+","+i+", "+t+")"},RGBToHex:function(e,t,n){var r=e<<16|t<<8|n;return r},RGBtoHSB:function(e,t,n){var r=Math.max(e,t,n),i=Math.min(e,t,n),s=0,o=0,u=0;r==i?s=0:r==e?s=(60*(t-n)/(r-i)+360)%360:r==t?s=60*(n-e)/(r-i)+120:r==n&&(s=60*(e-t)/(r-i)+240);u=r;r==0?o=0:o=(r-i)/r;return[s,o,u/255]},HSBtoRGB:function(e,t,n){var r=0,i=0,s=0,o=[],u=t,a=n,f=Math.floor(e/60)%6,l=e/60-Math.floor(e/60),c=a*(1-u),h=a*(1-l*u),p=a*(1-(1-l)*u);switch(f){case 0:r=a;i=p;s=c;break;case 1:r=h;i=a;s=c;break;case 2:r=c;i=a;s=p;break;case 3:r=c;i=h;s=a;break;case 4:r=p;i=c;s=a;break;case 5:r=a;i=c;s=h}o=[Math.round(r*255),Math.round(i*255),Math.round(s*255)];return o}}}(),o=function(){return{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,normalizeAngle:function(e){e+=3600;e%=360;return e},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))}}}(),u=function(){return{drawCircleSegment:function(e,t,n,r,i,s){t=t||0;n=n||360;r=r||100;i=i||0;var u,f,l,c,h=22.5,p=h*2;s=s||new a(0,0);if(i>r){u=r;r=i;i=u}if(t>n){u=n;n=t;t=u}n%=360;var d=a.polar(i,t*o.DEG_TO_RAD).add(s),v=a.polar(r,t*o.DEG_TO_RAD).add(s),m=a.polar(r,n*o.DEG_TO_RAD).add(s),g=a.polar(i,n*o.DEG_TO_RAD).add(s);e.moveTo(d.x,d.y);e.lineTo(v.x,v.y);for(f=t+p;f<n;f+=p){l=a.polar(r/Math.cos(h*o.DEG_TO_RAD),(f-h)*o.DEG_TO_RAD).add(s);c=a.polar(r,f*o.DEG_TO_RAD).add(s);e.quadraticCurveTo(l.x,l.y,c.x,c.y)}f=Math.max(f-p,t);l=a.polar(r/Math.cos((n-f)*.5*o.DEG_TO_RAD),(f+(n-f)*.5)*o.DEG_TO_RAD).add(s);e.quadraticCurveTo(l.x,l.y,m.x,m.y);e.lineTo(g.x,g.y);if(i==0)return;for(f=n-p;f>t;f-=p){l=a.polar(i/Math.cos(h*o.DEG_TO_RAD),(f+h)*o.DEG_TO_RAD).add(s);c=a.polar(i,f*o.DEG_TO_RAD).add(s);e.quadraticCurveTo(l.x,l.y,c.x,c.y)}f=Math.min(f+h+h,n);l=a.polar(i/Math.cos((f-t)*.5*o.DEG_TO_RAD),(f-(f-t)*.5)*o.DEG_TO_RAD).add(s);e.quadraticCurveTo(l.x,l.y,d.x,d.y)},drawCircleSegmentSpectrum:function(e,t,n,r,i,f){t=t||0;n=n||360;r=r||100;i=i||0;t=o.normalizeAngle(t);n=o.normalizeAngle(n);n<=t&&(n+=360);f||(f=new a);var l,c,h=0,p,d=n-t,v=360/Number(d);while(h<d){p=n-h;l=s.HSBtoRGB(h*v,1,1);c=l[0]<<16|l[1]<<8|l[2];e.fillStyle=s.uintToWebString(c);e.beginPath();u.drawCircleSegment(e,p-1,p+1,r,i,f);e.closePath();e.fill();++h}},drawCircleSegmentGradient:function(e,t,n,r,i,f,l,c){r=r||0;i=i||360;f=f||100;l=l||0;r=o.normalizeAngle(r);i=o.normalizeAngle(i);i<=r&&(i+=360);c||(c=new a);var h=0,p,d=i-r,v=1/Number(d),m;while(h<d){p=h+r;m=s.interpolateColor(t,n,h*v);e.save();e.fillStyle=s.uintToRGBString(m);e.beginPath();u.drawCircleSegment(e,p-1,p+1,f,l,c);e.closePath();e.fill();e.restore();++h}},drawCircleGradient:function(e,t,n,r,i){n=n||100;r=r||0;i||(i=new a);var s=n*2,u=e.createImageData(s,s),f=new a,l=new a,c,h,p,d,v=u.data.length,m=t>>16&255,g=t>>8&255,y=t&255;for(d=0;d<v;d+=4){l.x=f.x-i.x;l.y=f.y-i.y;c=l.length();if(c>=r&&c<=n){h=Math.atan2(l.y,l.x)*o.RAD_TO_DEG;h=o.normalizeAngle(h+90);h>180&&(h=360-h);h/=180;p=1;c<r+1?p=c-r:c>n-1&&(p=n-c);u.data[d+0]=m;u.data[d+1]=g;u.data[d+2]=y;u.data[d+3]=255*p*h}f.x++;if(f.x==s){f.x=0;f.y++}}e.putImageData(u,0,0)},drawCircle:function(e,t,n,r,i){n=n||100;r=r||0;i||(i=new a);var s=n*2,o=e.createImageData(s,s),u=new a,f=new a,l,c,h,p=o.data.length,d=t>>16&255,v=t>>8&255,m=t&255;for(h=0;h<p;h+=4){f.x=u.x-i.x;f.y=u.y-i.y;l=f.length();if(l>=r&&l<=n){c=1;l<r+1?c=l-r:l>n-1&&(c=n-l);o.data[h+0]=d;o.data[h+1]=v;o.data[h+2]=m;o.data[h+3]=255*c}u.x++;if(u.x==s){u.x=0;u.y++}}e.putImageData(o,0,0)}}}();a.polar=function(e,t){return new a(e*Math.sin(t),e*Math.cos(t))};return n}(window,jQuery);