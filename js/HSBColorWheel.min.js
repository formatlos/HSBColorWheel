/**
 *  @author Martin Raedlinger (mr@formatlos.de)
 */HSBColorWheel=function(e,t,n){function r(e,r,a,f,l){function O(){h.css({position:"absolute"});var e=Math.floor((C-N-3*k)/3),t=C;if(!d){d=new i(h,"h",t,t-e);d.onChange(function(){I(d)})}if(A!=null&&A!=n){var r=20;y=new o(h,t+r);y.addShadow(t-1,1996488704,0,r)}t-=e;A=="inner"&&y.addShadow(t,1996488704,0,-10);t-=k;A=="outer"&&y.addShadow(t,1996488704,0,10);if(!m){m=new i(h,"s",t+1,t-e);m.onChange(function(){I(m)})}t-=e;A=="inner"&&y.addShadow(t,1996488704,0,-10);t-=k;A=="outer"&&y.addShadow(t,1996488704,0,10);if(!v){v=new i(h,"b",t+1,t-e);v.onChange(function(){I(v)})}t-=e;A=="inner"&&y.addShadow(t,1996488704,0,-10);t-=k;A=="outer"&&y.addShadow(t,1996488704,0,10);g||(g=new s(h,t+1));p.on("mousedown"+c,z);p.on("mousemove"+c,W);p.on("mouseup"+c,X);h.on("mouseenter"+c,V);h.on("mouseleave"+c,J);q()}function M(){b=null;if(g){g.finalize();g=null}if(d){d.finalize();d=null}if(m){m.finalize();m=null}if(v){v.finalize();v=null}if(h){h.off(c);h.remove();h=null}if(p){p.off(c);p=null}}function _(e){L=e}function D(){var e=u.HSBtoRGB(S,x,T);return u.RGBToHex(e[0],e[1],e[2])}function P(){var e=u.HSBtoRGB(S,x,T);return{r:e[0],g:e[1],b:e[2]}}function H(e){var t=u.RGBtoHSB(e.r,e.g,e.b);S=t[0];x=t[1];T=t[2];q()}function B(){return{h:S,s:x,b:T}}function j(e){S=e.h;x=e.s;T=e.b;q()}function F(e,t){h.css({top:t,left:e})}function I(e){U();R(e==d,e!=v);var t={h:S,s:x,b:T},n={h:S,s:x,b:T};L&&L(B(),P())}function q(){d.setValue(S);m.setValue(x);v.setValue(T);R(!0,!0)}function R(e,t){var n,r;if(e){n=u.HSBtoRGB(S,1,1);r=u.RGBToHex(n[0],n[1],n[2]);m.setColor(r)}if(t){n=u.HSBtoRGB(S,x,1);r=u.RGBToHex(n[0],n[1],n[2]);v.setColor(r)}g.setColor(D())}function U(){S=d.getValue();x=m.getValue();T=v.getValue()}function z(e){if(!b)return;w=!0;b.mouseDown(e)}function W(e){if(!E)return;if(!w){var t=K(e.pageX,e.pageY);if(t!==b){b&&b.mouseOut();b=t;b&&b.mouseOver(e)}}b&&b.mouseMove(e)}function X(e){w=!1;if(!b)return;b.mouseUp(e);W(e)}function V(e){E=!0}function J(e){X(e);W(e);E=!1}function K(e,t){var n=h.offset(),r=e-n.left,i=t-n.top,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));if(d.isOver(s))return d;if(m.isOver(s))return m;if(v.isOver(s))return v}var c=".hsbcolorwheel",h=t('<div class="hsbcolorwheel"></div>').appendTo(e),p=t("body"),d=null,v=null,m=null,g=null,y=null,b=null,w=!1,E=!1,S=360,x=1,T=1,N=a||50,C=r||200,k=f||0,L=n,A=l;O();this.finalize=M;this.onChange=_;this.setRGB=H;this.getRGB=P;this.setHSB=j;this.getHSB=B;this.setPosition=F}function i(e,r,i,s){function k(){return C}function L(e){C=e;U()}function M(){return h=="h"?O*360:O}function _(e){h=="h"&&(e/=360);O=a.clamp(e,0,1);var t=360;if(h=="s"||h=="b")t=180;X((1-O)*t)}function D(){o=t("<div></div>").prependTo(e);g=t("<div></div>").appendTo(o);if(!A&&(h=="s"||h=="b")){w=t('<canvas width="'+T+'" height="'+T+'"></canvas>').appendTo(g);w.css({position:"absolute","margin-top":-x+"px","margin-left":-x+"px","-webkit-user-select":"none"});E=w.get(0).getContext("2d")}y=t('<canvas width="'+T+'" height="'+T+'"></canvas>').appendTo(g);y.css({position:"absolute","margin-top":-x+"px","margin-left":-x+"px","-webkit-user-select":"none"});b=y.get(0).getContext("2d");c=t("<div></div>").appendTo(o);c.css({position:"absolute","margin-top":-x+"px",width:"0px",height:"0px",opacity:"0.0","border-style":"solid","border-width":"15px 3px 0 3px","border-color":"#000000 transparent transparent transparent"});z();U()}function P(){m=null;y=null;c=null;b=null;g=null;w=null;E=null;if(o){o.remove();o=null}}function H(e){m=e}function B(e){return e>=S&&e<=x}function j(e){var t=o.offset(),n=e.pageX-t.left,r=e.pageY-t.top;d=p-Math.atan2(r,n)*(180/Math.PI);v=!0}function F(e){if(!v)return;var t=o.offset(),n=e.pageX-t.left,r=e.pageY-t.top;X(Math.atan2(r,n)*(180/Math.PI)+d);V(!0)}function I(e){if(!v)return;v=!1}function q(){c.stop().animate({opacity:.6},300)}function R(){c.stop().animate({opacity:0},300)}function U(){if(A){b.clearRect(0,0,T,T);if(h=="h")f.drawCircleSegmentSpectrum(b,180,540,x,S,N);else if(h=="s"){f.drawCircleSegmentGradient(b,16777215,C,0,180,x,S,N);f.drawCircleSegmentGradient(b,C,16777215,180,360,x,S,N)}else if(h=="b"){f.drawCircleSegmentGradient(b,0,C,0,180,x,S,N);f.drawCircleSegmentGradient(b,C,0,180,360,x,S,N)}}else if(h=="s"||h=="b"){E.clearRect(0,0,T,T);f.drawCircle(E,C,x,S,N)}}function z(){if(A)return;b.clearRect(0,0,T,T);h=="h"?f.drawCircleSegmentSpectrum(b,180,540,x,S,N):h=="s"?f.drawCircleGradient(b,16777215,x,S,N):h=="b"&&f.drawCircleGradient(b,0,x,S,N)}function W(e,t,n,r){var i;i=b.createRadialGradient(N.x,N.y,e,N.x,N.y,e+r);i.addColorStop(0,u.uintToRGBAString(t));i.addColorStop(1,u.uintToRGBAString(n));b.fillStyle=i;b.beginPath();b.arc(N.x,N.y,e,0,2*Math.PI,!1);b.arc(N.x,N.y,e+r,0,2*Math.PI,!0);b.fill()}function X(e){p=e;var t="rotate("+p+"deg)";g.css({"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}function V(e){var t=a.normalizeAngle(p),n;if(h=="s"||h=="b"){t>180&&(t=360-t);n=1/180}else n=1/360;var r=1-a.clamp(t*n,0,1);if(r!=O){O=r;e&&m&&m()}}var o=null,c=null,h=r||"h",p=0,d=0,v=!1,m=n,g=null,y=null,b=null,w=null,E=null,S=s,x=i,T=x*2,N=new l(x,x),C=0,A=!1,O=0;D();this.getColor=k;this.setColor=L;this.setValue=_;this.getValue=M;this.mouseDown=j;this.mouseMove=F;this.mouseUp=I;this.mouseOver=q;this.mouseOut=R;this.isOver=B;this.onChange=H;this.finalize=P;this.addShadow=W}function s(e,n){function f(e){a=e;h()}function l(){r=t('<canvas width="'+o+'" height="'+o+'"></canvas>').prependTo(e);r.css({position:"absolute","margin-top":-s+"px","margin-left":-s+"px"});i=r.get(0).getContext("2d")}function c(){i=null;if(r){r.remove();r=null}}function h(){i.clearRect(0,0,o,o);i.fillStyle=u.uintToWebString(a);i.beginPath();i.arc(s,s,s,0,Math.PI*2,!1);i.closePath();i.fill()}var r=null,i=null,s=n,o=s*2,a=0;l();this.setColor=f;this.finalize=c}function o(e,n){function a(){r=t('<canvas width="'+o+'" height="'+o+'"></canvas>').prependTo(e);r.css({position:"absolute","margin-top":-s+"px","margin-left":-s+"px"});i=r.get(0).getContext("2d")}function f(e,t,n,r){var o;o=i.createRadialGradient(s,s,e,s,s,e+r);o.addColorStop(0,u.uintToRGBAString(t));o.addColorStop(1,u.uintToRGBAString(n));i.fillStyle=o;i.beginPath();i.arc(s,s,e,0,2*Math.PI,!1);i.arc(s,s,e+r,0,2*Math.PI,!0);i.fill()}function l(){i=null;if(r){r.remove();r=null}}function c(){i.clearRect(0,0,o,o)}var r=null,i=null,s=n,o=s*2;a();this.clear=c;this.addShadow=f;this.finalize=l}function l(e,t){function n(e){return new l(this.x+e.x,this.y+e.y)}function r(){return Math.sqrt(this.x*this.x+this.y*this.y)}function i(e){return new l(this.x-e.x,this.y-e.y)}this.x=e||0;this.y=t||0;this.length=r;this.subtract=i;this.add=n}var u=function(){return{interpolateColor:function(e,t,n){var r=1-n,i=e>>24&255,s=e>>16&255,o=e>>8&255,u=e&255,a=t>>24&255,f=t>>16&255,l=t>>8&255,c=t&255,h=i*r+a*n,p=s*r+f*n,d=o*r+l*n,v=u*r+c*n,m=h<<24|p<<16|d<<8|v;return m},uintToWebString:function(e,t){t=t||6;var n=e.toString(16).toUpperCase();while(n.length<t)n="0"+n;return"#"+n.toUpperCase()},uintToRGBString:function(e){var t=e>>16&255,n=e>>8&255,r=e&255;return"rgb("+t+","+n+","+r+")"},uintToRGBAString:function(e){var t=(e>>24&255)/255,n=e>>16&255,r=e>>8&255,i=e&255;return"rgba("+n+","+r+","+i+", "+t+")"},RGBToHex:function(e,t,n){var r=e<<16|t<<8|n;return r},RGBtoHSB:function(e,t,n){var r=Math.max(e,t,n),i=Math.min(e,t,n),s=0,o=0,u=0;r==i?s=0:r==e?s=(60*(t-n)/(r-i)+360)%360:r==t?s=60*(n-e)/(r-i)+120:r==n&&(s=60*(e-t)/(r-i)+240);u=r;r==0?o=0:o=(r-i)/r;return[s,o,u/255]},HSBtoRGB:function(e,t,n){var r=0,i=0,s=0,o=[],u=t,a=n,f=Math.floor(e/60)%6,l=e/60-Math.floor(e/60),c=a*(1-u),h=a*(1-l*u),p=a*(1-(1-l)*u);switch(f){case 0:r=a;i=p;s=c;break;case 1:r=h;i=a;s=c;break;case 2:r=c;i=a;s=p;break;case 3:r=c;i=h;s=a;break;case 4:r=p;i=c;s=a;break;case 5:r=a;i=c;s=h}o=[Math.round(r*255),Math.round(i*255),Math.round(s*255)];return o}}}(),a=function(){return{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,normalizeAngle:function(e){e+=3600;e%=360;return e},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))}}}(),f=function(){return{drawCircleSegment:function(e,t,n,r,i,s){t=t||0;n=n||360;r=r||100;i=i||0;var o,u,f,c,h=22.5,p=h*2;s=s||new l(0,0);if(i>r){o=r;r=i;i=o}if(t>n){o=n;n=t;t=o}n%=360;var d=l.polar(i,t*a.DEG_TO_RAD).add(s),v=l.polar(r,t*a.DEG_TO_RAD).add(s),m=l.polar(r,n*a.DEG_TO_RAD).add(s),g=l.polar(i,n*a.DEG_TO_RAD).add(s);e.moveTo(d.x,d.y);e.lineTo(v.x,v.y);for(u=t+p;u<n;u+=p){f=l.polar(r/Math.cos(h*a.DEG_TO_RAD),(u-h)*a.DEG_TO_RAD).add(s);c=l.polar(r,u*a.DEG_TO_RAD).add(s);e.quadraticCurveTo(f.x,f.y,c.x,c.y)}u=Math.max(u-p,t);f=l.polar(r/Math.cos((n-u)*.5*a.DEG_TO_RAD),(u+(n-u)*.5)*a.DEG_TO_RAD).add(s);e.quadraticCurveTo(f.x,f.y,m.x,m.y);e.lineTo(g.x,g.y);if(i==0)return;for(u=n-p;u>t;u-=p){f=l.polar(i/Math.cos(h*a.DEG_TO_RAD),(u+h)*a.DEG_TO_RAD).add(s);c=l.polar(i,u*a.DEG_TO_RAD).add(s);e.quadraticCurveTo(f.x,f.y,c.x,c.y)}u=Math.min(u+h+h,n);f=l.polar(i/Math.cos((u-t)*.5*a.DEG_TO_RAD),(u-(u-t)*.5)*a.DEG_TO_RAD).add(s);e.quadraticCurveTo(f.x,f.y,d.x,d.y)},drawCircleSegmentSpectrum:function(e,t,n,r,i,s){t=t||0;n=n||360;r=r||100;i=i||0;t=a.normalizeAngle(t);n=a.normalizeAngle(n);n<=t&&(n+=360);s||(s=new l);var o,c,h=0,p,d=n-t,v=360/Number(d);while(h<d){p=n-h;o=u.HSBtoRGB(h*v,1,1);c=o[0]<<16|o[1]<<8|o[2];e.fillStyle=u.uintToWebString(c);e.beginPath();f.drawCircleSegment(e,p-1,p+1,r,i,s);e.closePath();e.fill();++h}},drawCircleSegmentGradient:function(e,t,n,r,i,s,o,c){r=r||0;i=i||360;s=s||100;o=o||0;r=a.normalizeAngle(r);i=a.normalizeAngle(i);i<=r&&(i+=360);c||(c=new l);var h=0,p,d=i-r,v=1/Number(d),m;while(h<d){p=h+r;m=u.interpolateColor(t,n,h*v);e.save();e.fillStyle=u.uintToRGBString(m);e.beginPath();f.drawCircleSegment(e,p-1,p+1,s,o,c);e.closePath();e.fill();e.restore();++h}},drawCircleGradient:function(e,t,n,r,i){n=n||100;r=r||0;i||(i=new l);var s=n*2,o=e.createImageData(s,s),u=new l,f=new l,c,h,p,d,v=o.data.length,m=t>>16&255,g=t>>8&255,y=t&255;for(d=0;d<v;d+=4){f.x=u.x-i.x;f.y=u.y-i.y;c=f.length();if(c>=r&&c<=n){h=Math.atan2(f.y,f.x)*a.RAD_TO_DEG;h=a.normalizeAngle(h+90);h>180&&(h=360-h);h/=180;p=1;c<r+1?p=c-r:c>n-1&&(p=n-c);o.data[d+0]=m;o.data[d+1]=g;o.data[d+2]=y;o.data[d+3]=255*p*h}u.x++;if(u.x==s){u.x=0;u.y++}}e.putImageData(o,0,0)},drawCircle:function(e,t,n,r,i){n=n||100;r=r||0;i||(i=new l);var s=n*2,o=e.createImageData(s,s),u=new l,a=new l,f,c,h,p=o.data.length,d=t>>16&255,v=t>>8&255,m=t&255;for(h=0;h<p;h+=4){a.x=u.x-i.x;a.y=u.y-i.y;f=a.length();if(f>=r&&f<=n){c=1;f<r+1?c=f-r:f>n-1&&(c=n-f);o.data[h+0]=d;o.data[h+1]=v;o.data[h+2]=m;o.data[h+3]=255*c}u.x++;if(u.x==s){u.x=0;u.y++}}e.putImageData(o,0,0)}}}();l.polar=function(e,t){return new l(e*Math.sin(t),e*Math.cos(t))};return r}(window,jQuery);